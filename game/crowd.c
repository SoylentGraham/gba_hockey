#include "../core/gba.h"
#include "../core/types.h"
#include "../core/tile_alloc.h"
#include "tile_sets.h"
#include "game.h"
#include "main.h"
#include "crowd.h"
#include "puck.h"
#include "rink_map.h"
#include "../media/map/map_data.h"

extern a_puck puck;



const u8 crowd_character_tile_sets[2][ CROWD_CHAR_COUNT ] = {
	{	CROWD_CHAR1_HEAD_TILES,	CROWD_CHAR2_HEAD_TILES,	CROWD_CHAR3_HEAD_TILES,	},
	{	CROWD_CHAR1_BODY_TILES,	CROWD_CHAR2_BODY_TILES,	CROWD_CHAR1_BODY_TILES,	},
};


const u8 one_only_crowd_map[ MEDIA_MAP_W * MEDIA_MAP_H ] = {
	  2,	  1,	  1,	  1,	  3,	  3,	  1,	  1,	  1,	  1,	  1,	  1,	  1,	  1,	  1,	  1,	  1,	  1,	  3,	  3,	  1,	  1,	  1,	  1,	  1,	  1,	  1,	  1,	  1,	  1,	  1,	  1,	  1,	  2,	  1,	  1,	  1,	  1,	  1,	  1,	  1,	  1,	  1,	  3,
	  2,	  1,	  1,	  3,	  1,	  1,	  3,	  1,	  2,	  1,	  1,	  3,	  1,	  1,	  3,	  3,	  1,	  3,	  1,	  1,	  1,	  3,	  1,	  3,	  3,	  1,	  1,	  1,	  1,	  1,	  1,	  1,	  1,	  1,	  1,	  1,	  3,	  3,	  1,	  1,	  1,	  1,	  3,	  3,
	  2,	  1,	  1,	  3,	  3,	  1,	  3,	  1,	  1,	  1,	  3,	  3,	  1,	  1,	  1,	  1,	  1,	  3,	  1,	  1,	  1,	  3,	  3,	  1,	  2,	  1,	  1,	  1,	  2,	  1,	  1,	  1,	  1,	  3,	  1,	  3,	  3,	  1,	  3,	  1,	  2,	  3,	  3,	  1,
	  1,	  3,	  1,	  3,	  3,	  1,	  3,	  3,	  1,	  1,	  1,	  1,	  1,	  1,	  1,	  2,	  1,	  3,	  1,	  1,	  2,	  1,	  3,	  3,	  1,	  1,	  3,	  1,	  3,	  1,	  3,	  1,	  3,	  3,	  1,	  1,	  1,	  1,	  1,	  3,	  1,	  3,	  1,	  1,
	  1,	  1,	  1,	  3,	  1,	  1,	  1,	  3,	  1,	  1,	  1,	  1,	  1,	  1,	  1,	  1,	  1,	  3,	  1,	  1,	  1,	  1,	  3,	  1,	  1,	  1,	  3,	  1,	  1,	  1,	  1,	  1,	  1,	  1,	  1,	  2,	  1,	  1,	  1,	  3,	  1,	  1,	  1,	  1,
	  1,	  1,	  1,	  1,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  1,	  1,	  2,	  1,
	  1,	  2,	  1,	  3,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  3,	  1,	  1,	  1,
	  1,	  1,	  1,	  1,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  3,	  1,	  2,	  1,
	  1,	  1,	  1,	  3,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  3,	  1,	  1,	  1,
	  1,	  3,	  1,	  1,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  1,	  1,	  1,	  1,
	  1,	  3,	  3,	  3,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  1,	  1,	  2,	  1,
	  1,	  1,	  1,	  1,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  2,	  1,	  1,	  1,
	  1,	  2,	  1,	  3,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  1,	  1,	  1,	  1,
	  1,	  1,	  3,	  3,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  1,	  1,	  1,	  1,
	  1,	  1,	  2,	  1,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  1,	  1,	  1,	  1,
	  1,	  3,	  1,	  1,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  1,	  2,	  1,	  1,
	  1,	  3,	  1,	  1,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  1,	  1,	  1,	  1,
	  1,	  1,	  1,	  2,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  1,	  1,	  1,	  1,
	  1,	  1,	  1,	  1,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  3,	  1,	  3,	  3,	  1,
	  1,	  1,	  3,	  1,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  3,	  3,	  1,	  1,
	  1,	  1,	  2,	  3,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  1,	  3,	  3,	  1,
	  1,	  1,	  1,	  3,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  1,	  3,	  3,	  1,
	  1,	  1,	  1,	  3,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  3,	  3,	  1,	  3,
	  1,	  3,	  3,	  3,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  3,	  1,	  1,	  1,
	  1,	  3,	  1,	  1,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  3,	  3,	  3,	  1,
	  1,	  1,	  3,	  1,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  1,	  1,	  3,	  3,
	  3,	  1,	  1,	  3,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  1,	  1,	  1,	  1,
	  3,	  1,	  2,	  1,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  3,	  2,	  1,	  1,
	  3,	  1,	  1,	  1,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  3,	  1,	  1,	  1,
	  1,	  2,	  1,	  1,	  3,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  3,	  1,	  1,	  1,	  1,
	  1,	  1,	  3,	  3,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  3,	  3,	  1,	  3,	  1,
	  1,	  3,	  1,	  1,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  3,	  1,	  1,	  2,
	  1,	  3,	  3,	  1,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  3,	  1,	  1,	  1,
	  1,	  3,	  3,	  1,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  2,	  3,	  1,	  1,
	  1,	  1,	  3,	  1,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  1,	  1,	  1,	  1,
	  1,	  1,	  1,	  3,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  1,	  1,	  2,	  1,
	  1,	  3,	  2,	  3,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  3,	  1,	  1,	  1,
	  1,	  3,	  1,	  1,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  3,	  1,	  3,	  1,
	  1,	  1,	  1,	  1,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  3,	  3,	  1,	  2,	  1,
	  3,	  1,	  1,	  3,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  3,	  3,	  1,	  1,	  1,
	  3,	  1,	  1,	  1,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  3,	  1,	  3,	  1,	  1,
	  3,	  2,	  1,	  1,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  3,	  1,	  2,	  1,	  1,
	  1,	  1,	  1,	  3,	  3,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  1,	  1,	  1,	  3,
	  3,	  1,	  1,	  1,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  1,	  1,	  3,	  1,
	  1,	  3,	  1,	  2,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  2,	  2,	  1,	  1,
	  3,	  3,	  1,	  1,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  1,	  1,	  1,	  1,
	  3,	  1,	  2,	  1,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  1,	  1,	  2,	  1,
	  3,	  3,	  1,	  1,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  1,	  1,	  1,	  1,
	  1,	  3,	  1,	  1,	  1,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  1,	  1,	  1,	  1,
	  1,	  1,	  3,	  3,	  3,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  0,	  1,	  1,	  1,	  1,	  1,
	  2,	  2,	  1,	  1,	  3,	  1,	  1,	  1,	  3,	  3,	  1,	  1,	  1,	  1,	  1,	  3,	  3,	  3,	  1,	  3,	  1,	  1,	  1,	  1,	  3,	  3,	  1,	  1,	  3,	  1,	  3,	  3,	  1,	  1,	  1,	  1,	  1,	  1,	  1,	  1,	  1,	  3,	  1,	  1,
	  3,	  3,	  1,	  1,	  2,	  3,	  1,	  3,	  1,	  3,	  1,	  1,	  1,	  2,	  1,	  1,	  1,	  1,	  1,	  3,	  3,	  3,	  3,	  1,	  1,	  1,	  3,	  3,	  3,	  3,	  1,	  3,	  3,	  2,	  1,	  1,	  1,	  1,	  3,	  1,	  1,	  1,	  2,	  1,
	  1,	  3,	  1,	  2,	  1,	  3,	  1,	  3,	  1,	  1,	  3,	  1,	  1,	  1,	  1,	  1,	  2,	  1,	  1,	  1,	  1,	  1,	  3,	  3,	  1,	  1,	  3,	  1,	  1,	  1,	  3,	  3,	  3,	  1,	  1,	  1,	  2,	  1,	  1,	  3,	  3,	  1,	  1,	  1,
	  1,	  1,	  1,	  1,	  1,	  1,	  3,	  3,	  1,	  1,	  1,	  1,	  1,	  1,	  3,	  1,	  1,	  3,	  1,	  1,	  1,	  1,	  1,	  3,	  3,	  1,	  3,	  3,	  1,	  2,	  1,	  3,	  1,	  1,	  2,	  1,	  1,	  2,	  1,	  1,	  1,	  1,	  1,	  3,
	  2,	  2,	  2,	  2,	  1,	  1,	  1,	  1,	  1,	  1,	  2,	  1,	  1,	  1,	  1,	  3,	  1,	  3,	  3,	  3,	  3,	  3,	  3,	  3,	  3,	  3,	  3,	  1,	  1,	  1,	  1,	  1,	  3,	  3,	  1,	  1,	  1,	  1,	  1,	  1,	  1,	  2,	  1,	  3,
};
/*
const u8 one_only_crowd_map[ MEDIA_MAP_W * MEDIA_MAP_H ] = {
     1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
     0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,
     1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1
}; */

u8	*crowd_char_map= &one_only_crowd_map[0];	//all in 0->MAX_CHAR_COUNT fashion
u8 crowd_mexwave_ticker[ MEDIA_MAP_W*MEDIA_MAP_H];

//x and y coords of the main center of the crowd to base the head-turn-towards puck implementation
#define TILE_TO_REAL_COORD(t) ( (t*TILE_W)<<8 )
const u32 crowd_center_tile_x[ DIR_COUNT ] = {	TILE_TO_REAL_COORD(MEDIA_MAP_W/2),	TILE_TO_REAL_COORD(MEDIA_MAP_W-2),	TILE_TO_REAL_COORD(MEDIA_MAP_W-2),	TILE_TO_REAL_COORD(MEDIA_MAP_W-2),	TILE_TO_REAL_COORD(MEDIA_MAP_W/2),	TILE_TO_REAL_COORD(2),	TILE_TO_REAL_COORD(2),	TILE_TO_REAL_COORD(2),	};
const u32 crowd_center_tile_y[ DIR_COUNT ] = {	TILE_TO_REAL_COORD(2),	TILE_TO_REAL_COORD(2),	TILE_TO_REAL_COORD(MEDIA_MAP_H/2),	TILE_TO_REAL_COORD(MEDIA_MAP_H-2),	TILE_TO_REAL_COORD(MEDIA_MAP_H-2),	TILE_TO_REAL_COORD(MEDIA_MAP_H-2),	TILE_TO_REAL_COORD(MEDIA_MAP_H/2),	TILE_TO_REAL_COORD(2),	};

/*
const u8 crowd_mem_frame_on_mex_wav[MEX_WAVE_PEAK] = { 
	0,//jumps to last and goes backwards
	1,2,
	3, 2, 3, 3, 2, 3, 3, 2, 3, 3, 2, 3, 3, 2,
	3,2,1,
};*/
/*const u8 crowd_mem_frame_on_mex_wav[MEX_WAVE_PEAK] = { 
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
	2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
	3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
	2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
	1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
};*/
const u8 crowd_mem_frame_on_mex_wav[MEX_WAVE_PEAK] = { 
	0, 1, 2, 3, 2, 1,
};

extern u16 *tile_map[4];



void update_crowd_member( u16 x, u16 y, u16 map_a, u8 mex_wave_loop, u16 *tile_start, u8 *face_ang)
{
	u16 screen_a[2];
	u16 crowd_tile;

	crowd_tile = CROWD_TILE_N( face_ang[CROWD_MEM_ANG_A(map_a)], CROWD_MEM_CHAR_A(map_a), CROWD_MEM_FRAME_A(map_a) );

	tile_start[ CROWD_HEAD ] = BG_TILE( BG(CROWD_HEAD_BG), crowd_character_tile_sets[CROWD_HEAD][CROWD_MEM_CHAR_A(map_a)]);
	tile_start[ CROWD_BODY ] = BG_TILE( BG(CROWD_BODY_BG), crowd_character_tile_sets[CROWD_BODY][CROWD_MEM_CHAR_A(map_a)]);

	if (y>camera_y_scroll)
	{
		screen_a[0] = XY_ARRAY( ROLL_SCREEN_NUMBER(x),ROLL_SCREEN_NUMBER(y-1),32);
		tile_map[2][screen_a[0]] = tile_start[CROWD_HEAD] + crowd_tile;
	}

	if (y+1<FULL_TILE_H+camera_y_scroll)
	{
		screen_a[1] = XY_ARRAY( ROLL_SCREEN_NUMBER(x),ROLL_SCREEN_NUMBER(y),32);
		tile_map[3][screen_a[1]] = tile_start[CROWD_BODY] + crowd_tile;
	}

	mex_wave_loop = true;

	//keeps mexican wave looping
	if ( mex_wave_loop && MEX_WAVE_TICK_A(map_a)==0 )
		MEX_WAVE_TICK_A(map_a) = MEX_WAVE_PEAK+1;

	//reduce mex wave tick
	if ( MEX_WAVE_TICK_A(map_a)>0 )
		MEX_WAVE_TICK_A(map_a)--;

	//update frame number based on wave tick#
	//update: automaticcly taken from mex wave
	//CROWD_MEM_FRAME_A(a) = crowd_mem_frame_on_mex_wav[ MEX_WAVE_TICK_A(a) ];
			
	//dont broadcast if looping, as always updates anyways
	if ( MEX_WAVE_TICK_A(map_a)>MEX_WAVE_DROP && !mex_wave_loop )
		broadcast_mexwav(x,y,MEX_WAVE_TICK_A(map_a));
}


void init_crowd_update( u8 *face_ang, u16 *tile_start )
{
	u8 i;

	for (i=0;i<DIR_COUNT;i++)
	{
	//	ang = ANG_TO_COORD( crowd_center_tile_x[i], crowd_center_tile_x[i], puck.x, puck.y );
	//	ang /= (360/DIR_COUNT);
	//	face_ang[i] = (u8)roll_u16(ang,0,DIR_COUNT);
		face_ang[i] = i;
	}

	tile_start[ CROWD_HEAD ] = BG_TILE( BG(CROWD_HEAD_BG), crowd_character_tile_sets[CROWD_HEAD][0]);
	tile_start[ CROWD_BODY ] = BG_TILE( BG(CROWD_BODY_BG), crowd_character_tile_sets[CROWD_BODY][0]);
}


void update_crowd_row(s16 row, u8 mex_wave_loop, u8 loop_offset) 
{
	u8 x_offset = RINK_CAMERA_TILE_X;
	u8 y_offset = RINK_CAMERA_TILE_Y;
	u16 x,y,n,map_a,m,crowd_tile;
	u16 tile_start[2];
	u16 ang;
	u8 face_ang[DIR_COUNT];
	u16 max;

	init_crowd_update( face_ang, tile_start );

	y = row + camera_y_scroll;
	x = camera_x_scroll + loop_offset;
	
	n = VISIBLE_TILE_W+camera_x_scroll+1;
	map_a = XY_ARRAY(x,y,MEDIA_MAP_W);

	max = XY_ARRAY(n,y,MEDIA_MAP_W);
	if ( max > MAX_CROWD_MAP_A )
		max = MAX_CROWD_MAP_A;

	while(map_a<max)
	{
		//if(0)
		if ( IS_CROWD_MEM_A(map_a) )
			update_crowd_member( x, y, map_a, mex_wave_loop, tile_start, face_ang );
		map_a += CROWD_COLUMN_PER_ROW_UPDATE_RATE;
		x += CROWD_COLUMN_PER_ROW_UPDATE_RATE;
	}
}



void update_crowd_column(s16 column, u8 mex_wave_loop) 
{
	u8 x_offset = RINK_CAMERA_TILE_X;
	u8 y_offset = RINK_CAMERA_TILE_Y;
	u16 i,x,y,n,map_a,m,crowd_tile;
	u16 tile_start[2];
	u16 ang;
	u8 face_ang[DIR_COUNT];
	u16 max;

	init_crowd_update( face_ang, tile_start );

	y = camera_y_scroll;
	x = column + camera_x_scroll ;
/*
	max = XY_ARRAY(n,y,MEDIA_MAP_W);
	if ( max > MAX_CROWD_MAP_A )
		max = MAX_CROWD_MAP_A;
*/
	map_a = XY_ARRAY(x,y,MEDIA_MAP_W);

	while(y<VISIBLE_TILE_H+camera_y_scroll)
	{
		//map_a = XY_ARRAY(x,y,MEDIA_MAP_W);

		if ( IS_CROWD_MEM_A(map_a) )
		{
			update_crowd_member( x, y, map_a, mex_wave_loop, tile_start, face_ang );
		}
		//map_a++; //for use in x<max
		map_a += MEDIA_MAP_W;
		if ( map_a > MAX_CROWD_MAP_A )
			break;
		y++;
	}


/*	map_a = XY_ARRAY(x,y,MEDIA_MAP_W);

//	n = VISIBLE_TILE_H+camera_y_scroll+1;
	//n = VISIBLE_TILE_W+camera_x_scroll+1;
	//max = XY_ARRAY(x,n,MEDIA_MAP_W);

	max = map_a + ( MEDIA_MAP_W * VISIBLE_TILE_H );
	if ( max > MAX_CROWD_MAP_A )
		max = MAX_CROWD_MAP_A;

	while(map_a<max)
	{
		//if(0)
		if ( IS_CROWD_MEM_A(map_a) )
			update_crowd_member( x, y, map_a, mex_wave_loop, tile_start, face_ang );
		map_a += MEDIA_MAP_W;
		y += MEDIA_MAP_W;
	}
*/

}

/*
//score goal keeps the crowd animated and skips broadcasting, as eveyrone is celebrating
void update_mex_wave(u8 loop) 
{
	u8 x,y,a,m,n;
	for (x=0;x<MAP_W;x++)	for (y=0;y<MAP_H;y++)
	{
		a = XY_ARRAY(x,y,MAP_W);
		m = CROWD_MEM_A(a);
		if (IS_CROWD_MEM(m))
		{
			//keeps mexican wave looping
			if ( loop && MEX_WAVE_TICK_A(a)==0 )
				MEX_WAVE_TICK_A(a) = MEX_WAVE_PEAK+1;

			//reduce mex wave tick
			if ( MEX_WAVE_TICK_A(a)>0 )
				MEX_WAVE_TICK_A(a)--;

			//update frame number based on wave tick#
			//update: automaticcly taken from mex wave
			//CROWD_MEM_FRAME_A(a) = crowd_mem_frame_on_mex_wav[ MEX_WAVE_TICK_A(a) ];
			
			//dont broadcast if looping, as always updates anyways
			if ( MEX_WAVE_TICK_A(a)>MEX_WAVE_DROP && !loop )
				broadcast_mexwav(x,y,MEX_WAVE_TICK_A(a));
		}
	}
}
*/

void broadcast_mexwav(u8 root_x,u8 root_y,u8 root_val) 
{
	u8 i,x,y;
	for (i=0;i<DIR_COUNT;i+=2)
	{
		x = root_x + dir_data_x[i];
		y = root_y + dir_data_y[i];
		
		if ( x>=0 && y>=0 && x<MEDIA_MAP_W && y<MEDIA_MAP_H && IS_CROWD_MEM(x,y)) )
		{
			if ( MEX_WAVE_TICK(x,y)==0 )
				//MEX_WAVE_TICK(x,y) = root_val;
				MEX_WAVE_TICK(x,y) = MEX_WAVE_PEAK;
		}
	}
}



